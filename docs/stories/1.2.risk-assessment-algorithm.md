# Story 1.2: Risk Assessment Algorithm

## Status
Draft

## Story

**As a** Corona-Warn-App user,
**I want** the app to calculate my COVID-19 exposure risk based on my encounter history,
**so that** I receive accurate, timely warnings when I've had high-risk contact with infected individuals.

## Acceptance Criteria

1. **Risk Calculation Algorithm**
   - Algorithm considers encounter duration (cumulative time within proximity)
   - Algorithm considers proximity level (based on Bluetooth signal strength/RSSI)
   - Algorithm considers number of separate encounters with same infected person
   - Algorithm follows epidemiological guidelines from RKI (Robert Koch Institut)

2. **Configurable Risk Thresholds**
   - Risk levels: Green (no risk), Yellow (low risk), Red (high risk)
   - Thresholds configurable through remote configuration (for health authority updates)
   - Algorithm parameters can be updated without app store releases
   - Different risk calculations for indoor vs outdoor encounters (if detectable)

3. **Risk Notification System**
   - High-risk users receive immediate push notifications
   - Low-risk users receive daily summary notifications
   - No-risk users receive weekly status confirmations
   - Notifications include clear, actionable next steps

4. **Risk Assessment Timing**
   - Continuous background risk assessment every 4 hours
   - Immediate assessment when new positive case data is downloaded
   - Risk status updates within 1 hour of receiving new infection data
   - Historical risk data maintained for 14 days for trend analysis

5. **Risk Communication**
   - Risk level displayed prominently in app dashboard
   - Risk explanations in simple, non-technical German language
   - Clear differentiation between "exposure" and "infection"
   - Guidance on appropriate actions for each risk level

## Tasks / Subtasks

- [ ] **Core Risk Algorithm Development** (AC: 1)
  - [ ] Implement RKI-approved epidemiological risk model
  - [ ] Create proximity scoring based on RSSI values
  - [ ] Develop duration-based risk calculation
  - [ ] Implement multiple encounter aggregation logic

- [ ] **Risk Threshold Management** (AC: 2)
  - [ ] Design remote configuration system for risk parameters
  - [ ] Implement risk level classification (Green/Yellow/Red)
  - [ ] Create algorithm parameter update mechanism
  - [ ] Add environment-based risk adjustments

- [ ] **Notification & Alert System** (AC: 3, 5)
  - [ ] Implement push notification infrastructure
  - [ ] Design risk-appropriate notification content
  - [ ] Create clear action guidance for each risk level
  - [ ] Implement notification frequency controls

- [ ] **Background Processing & Updates** (AC: 4)
  - [ ] Create background job for periodic risk assessment
  - [ ] Implement real-time risk updates on new data
  - [ ] Design risk history tracking and analysis
  - [ ] Optimize processing for battery efficiency

## Dev Notes

### Risk Assessment Context
- **Algorithm Basis:** Epidemiological models from RKI and European health authorities
- **Input Data:** Encounter duration, proximity (RSSI), encounter frequency, time since exposure
- **Risk Factors:** 15 minutes at <2m distance = high risk (baseline), adjustable by health authorities
- **Output:** Risk score (0-100) mapped to color categories

### Technical Architecture
- **Processing:** Local device computation only - no server-side risk calculation
- **Data Sources:** Local encounter database + downloaded positive case keys
- **Configuration:** Remote JSON configuration file for algorithm parameters
- **Storage:** Risk assessment history stored locally, encrypted

### RKI Algorithm Requirements
- Minimum 15 minutes cumulative exposure time for risk consideration
- Distance estimation based on calibrated RSSI values
- Day-based risk windows (not continuous scoring)
- Risk decay over time (older exposures less significant)

### Risk Communication Guidelines
- **Green (No Risk):** "Sie hatten keine Risiko-Begegnungen" (No risky encounters)
- **Yellow (Low Risk):** "Niedriges Risiko - Beobachten Sie Ihr Wohlbefinden" (Low risk - monitor your health)
- **Red (High Risk):** "ErhÃ¶htes Risiko - Kontaktieren Sie Ihren Arzt" (Elevated risk - contact your doctor)

### Performance Requirements
- Risk calculation must complete within 30 seconds on average device
- Background processing should not impact foreground app performance
- Algorithm updates must not require app restart

## Testing

### Testing Standards
- **Unit Tests:** All risk calculation functions, threshold logic, notification triggers
- **Integration Tests:** End-to-end risk assessment with simulated encounter data
- **Algorithm Tests:** Validate against RKI test cases and epidemiological scenarios
- **Performance Tests:** Risk calculation speed with large encounter datasets

### Test File Location
- iOS: `CWATests/RiskAssessmentTests.swift`
- Android: `app/src/test/java/de/rki/coronawarnapp/risk/`

### Specific Testing Requirements
- **Epidemiological Validation:** Test risk scores against known exposure scenarios
- **Configuration Testing:** Verify remote parameter updates work correctly
- **Notification Testing:** Validate appropriate notification timing and content
- **Edge Case Testing:** Handle corrupt data, missing encounters, algorithm edge cases

### Test Data Requirements
- Simulated encounter datasets with known risk outcomes
- RKI-provided test scenarios for algorithm validation
- Performance benchmarks with 1000+ encounters
- Multi-language notification content validation

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-08 | 1.0 | Initial story creation from Epic 1 | Sarah (PM) |